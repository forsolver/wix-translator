/**
 * @file: changelog.md
 * @description: Хронологический журнал всех изменений
 * @dependencies: Project.md, Tasktracker.md
 * @created: 2025-05-26
 * @updated: 2025-05-26
 */

# Changelog: Wix Translator

## [2025-12-20] - Реорганизация структуры проекта

### Добавлено
- **Структура папок проекта**: Создана четкая организация файлов
  - `input/` - папка для исходных CSV файлов
  - `output/` - папка для переведенных файлов  
  - `cache/` - папка для кэша переводов
- **Автоматическое создание папок**: Папки создаются при первом запуске
- **Умная обработка путей**: Автоматический поиск файлов в папке input/
- **README.md**: Подробное руководство по использованию с новой структурой

### Изменено
- **Константы путей**: Добавлены `INPUT_DIR`, `OUTPUT_DIR`, `CACHE_DIR`, `CACHE_FILE`
- **Функции кэширования**: Обновлены для использования папки cache/
- **CLI аргументы**: Обновлены описания для работы с новой структурой
- **Логика путей**: Интеллектуальный поиск входных файлов и сохранение выходных

### Перемещено
- Исходные файлы (`export_en.csv`, `export_en_tail.csv`) → `input/`
- Переведенные файлы (`*_translated.csv`) → `output/`
- Кэш переводов (`.translation_cache.json`) → `cache/translation_cache.json`

### Улучшено
- **Чистота корневого каталога**: Убраны CSV файлы из корня проекта
- **Удобство использования**: Простые команды для запуска переводов
- **Масштабируемость**: Легко управлять множеством файлов

## [2025-05-26] - Реализация новых требований и полная архитектурная реструктуризация

### Добавлено
- **Фильтрация типов строк**: Система теперь переводит только строки определенных типов
  - Поддерживаемые типы: `catalog-product`, `wysiwyg.viewer.components.WRichText`, `document.api.MenuService.Menu`
  - Исключаемые типы: `offline_payment_method`
- **Специальная обработка меню**: Для типа `document.api.MenuService.Menu` переводятся только теги `<label>`
- **Асинхронная обработка**: Переход на `openai.AsyncClient` для максимальной производительности
- **Система кэширования**: Автоматическое сохранение переводов в `.translation_cache.json` с MD5-ключами
- **Примеры запуска**: Создан `examples/run_examples.md` с детальными инструкциями
- **Тестовые данные**: Создан `examples/test_data.csv` с примерами всех типов строк
- Функции `is_row_translatable()` и `get_tags_for_row_type()` для умной фильтрации
- Функции кэширования: `get_cache_key()`, `save_cache_to_file()`, `load_cache_from_file()`
- Асинхронная функция `openai_translate_batch_async()` с поддержкой кэша

### Изменено
- **Полная реструктуризация** функции `main()` для поддержки фильтрации и кэширования
- **Обновлена функция** `process_row()` для работы с типами строк и специальными тегами
- **Переписана функция** `get_lang_columns()` для возврата списка целевых колонок
- **Константы тегов**: Разделены на `TAGS` (основные) и `MENU_TAGS` (для меню)
- **Импорты**: Добавлены `asyncio`, `hashlib`, `json`, обновлен `tqdm`
- **Документация проекта**: Полностью обновлен `docs/Project.md` с новой архитектурой
- **Трекер задач**: Обновлен `docs/Tasktracker.md` с выполненными задачами

### Исправлено
- **Производительность**: Реализованы все запланированные оптимизации
- **Безопасность**: `.translation_cache.json` добавлен в `.gitignore`
- **Совместимость**: Сохранена обратная совместимость с синхронной функцией перевода

## [2024-12-20] - Полное исправление системы переводов
### Исправлено
- Полностью устранена проблема с разделителем "---" в переводах
- Исправлена фильтрация элементов по типу "Element type" вместо неправильных колонок
- Исправлена обработка XML-тегов label в меню через регулярные выражения
- Заменен промпт на нумерованный список вместо разделителей
- Добавлен парсинг нумерованных ответов от GPT

### Добавлено  
- Новые запрещенные типы элементов:
  - `wixui.ImageX` - изображения не переводятся
  - `wix.forms.v4.Form` - формы не переводятся  
  - `ribbon` - ленты не переводятся
  - `shipping-rule` - правила доставки не переводятся

### Тестирование
- ✅ Фильтрация типов элементов работает корректно
- ✅ Меню переводятся правильно (label теги)
- ✅ Отсутствие разделителей в финальных переводах
- ✅ Корректная обработка запрещенных типов

## [2025-05-26] - Первоначальная реализация с базовой функциональностью

### Добавлено
- Базовая архитектура проекта
- Парсер CSV для экспортированных данных Wix
- Извлечение и замена текста в HTML-тегах
- Интеграция с OpenAI GPT-4o API
- Батчевая обработка переводов
- Фильтрация пустых и дублирующихся текстов
- CLI-интерфейс
- Перевод кодов языков в человекочитаемые названия
- Документация: Project.md, Tasktracker.md, Diary.md, qa.md
- Git репозиторий с защитой секретов

### Технические детали
- Python 3.10+ с зависимостями: pandas, beautifulsoup4, openai, tqdm, python-dotenv
- Поддержка HTML тегов: `<b>`, `<h1>`, `<h2>`, `<li>`, `<ol>`, `<p>`, `<ul>`
- Логирование только ошибок для производительности
- Защита OpenAI API ключа через .env файл

---

**Итого изменений**: Система полностью переработана согласно обновленным требованиям, добавлена поддержка фильтрации типов строк, асинхронной обработки, кэширования и специальной обработки меню. Производительность оптимизирована для работы с файлами до 50,000 строк. 